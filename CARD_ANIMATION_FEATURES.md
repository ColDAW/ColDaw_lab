# 动态卡片动画功能说明

## 🎨 功能概述

实现了一个动态的、交互式的音轨卡片展示系统，卡片会自动进行添加、删除和修改操作，模拟真实的 DAW 协作场景。

## ✨ 核心特性

### 1. **三种动态操作**

#### 🟢 添加 (Add)
- **角标**: 绿色圆形，带 `+` 号
- **行为**: 
  - 新卡片随机插入某一行
  - 同行其他卡片自动让开空间（向右推移）
  - 卡片从目标位置偏移进入，带缩放效果
- **动画**: 1.2秒慢速吸附，无弹跳
- **角标消失**: 3秒后自动移除

#### 🔴 删除 (Remove)
- **角标**: 红色圆形，带 `−` 号
- **行为**:
  - 随机选择一个已存在的卡片标记删除
  - 卡片缩小并淡出
  - 1秒后彻底移除
  - 同行其他卡片自动填补空缺（向左移动）
- **动画**: 0.8秒缩放淡出

#### 🟠 修改 (Modify)
- **角标**: 橙色圆形，带 `✦` 号
- **行为**:
  - 随机选择一个卡片修改内容
  - 波形图案随机变化
  - 位置和大小保持不变
- **动画**: 波形平滑过渡
- **角标消失**: 3秒后自动移除

### 2. **自动排版 (Auto Layout)**

模仿 Figma 的 Auto Layout 系统：

- **智能间距**: 卡片之间自动保持 16px 间距
- **行居中**: 每行卡片作为整体居中显示
- **流式布局**: 
  - 添加卡片时，后续卡片自动右移
  - 删除卡片时，后续卡片自动左移填补
- **平滑过渡**: 所有位置变化使用 0.6s 缓动动画

### 3. **视觉设计**

#### 卡片样式
- 毛玻璃背景：`backdrop-filter: blur(10px)`
- 渐变色彩：每行有独特的颜色主题
  - Piano (Row 0): 🟢 绿色 `#4CAF50`
  - Vocal (Row 1): 🔵 蓝色 `#2196F3`
  - Texture (Row 2): 🟣 紫色 `#9C27B0`
  - Bass (Row 3): 🟠 橙色 `#FF9800`

#### 角标设计
- **位置**: 卡片右上角 `top: -8px, right: -8px`
- **大小**: 28x28px 圆形
- **材质**: 毛玻璃背景 + 边框
- **动画**: 持续的脉冲效果 (`badgePulse`)
- **层级**: `z-index: 5` 确保始终可见

#### 波形可视化
- 每个卡片显示独特的音频波形图案
- 修改操作会改变波形的随机种子
- 使用 `Math.sin()` 生成自然的波浪形状

### 4. **触发机制**

#### IntersectionObserver
- 当卡片容器进入视口 20% 时触发动画
- `rootMargin: '-50px'` 提前触发
- 避免不必要的动画开销

#### 定时操作
- **首次延迟**: 5秒后开始第一次操作
- **随机间隔**: 每次操作后等待 3-8 秒
- **随机操作**: 从添加、删除、修改中随机选择

### 5. **性能优化**

- **条件渲染**: 只在卡片可见时执行动态操作
- **CSS Transitions**: 使用硬件加速的 CSS 动画
- **智能清理**: 组件卸载时清除所有定时器
- **状态管理**: 使用 React useState 最小化重渲染

## 🎯 技术实现

### 数据结构

```typescript
type CardData = {
  id: string;              // 唯一标识
  title: string;           // 轨道名称
  color: string;           // 主题颜色
  width: number;           // 卡片宽度
  row: number;             // 所在行号
  col: number;             // 所在列号
  badge?: 'add' | 'remove' | 'modify'; // 角标类型
  waveformSeed?: number;   // 波形随机种子
};
```

### 动画时序

```
初始状态 → 视口触发 → 卡片飞入 → 5秒等待 → 开始动态操作

每次操作:
  选择操作类型 (add/remove/modify)
    ↓
  执行对应动画
    ↓
  3秒后移除角标 (add/modify)
  或 1秒后删除卡片 (remove)
    ↓
  等待 3-8 秒
    ↓
  下一次操作
```

### CSS 缓动函数

```css
/* 慢速吸附效果（无弹跳） */
cubic-bezier(0.23, 1, 0.32, 1)

/* hover 弹性效果 */
cubic-bezier(0.34, 1.56, 0.64, 1)
```

## 🎬 使用场景

1. **产品展示**: 展示 DAW 的实时协作能力
2. **用户引导**: 演示多人同时编辑的场景
3. **视觉吸引**: 动态效果吸引访客注意力
4. **功能说明**: 直观展示版本控制概念

## 🔧 自定义配置

可调整的参数：

```typescript
// 操作间隔时间
const nextDelay = 3000 + Math.random() * 5000; // 3-8秒

// 首次触发延迟
setTimeout(performRandomAction, 5000); // 5秒

// 角标显示时长
setTimeout(() => { /* 移除角标 */ }, 3000); // 3秒

// 卡片动画速度
transition: transform 1.2s ... // 1.2秒
```

## 📝 注意事项

1. **最小卡片数**: 删除操作会检查至少保留 3 个卡片
2. **行一致性**: 同一行的所有卡片颜色和标题保持一致
3. **清理机制**: 组件卸载时自动清除所有定时器
4. **性能考虑**: 只在卡片可见时执行动态操作

## 🎨 视觉效果总结

- ✅ 流畅的进入动画（1.2秒吸附）
- ✅ 智能的空间管理（自动排版）
- ✅ 清晰的操作提示（彩色角标）
- ✅ 动态的内容变化（波形切换）
- ✅ 优雅的退出动画（缩放淡出）
- ✅ 持续的视觉兴趣（脉冲效果）
